// JayData 1.5.0 CTP
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
!function(){var e;(e="function"!=typeof define||"function"==typeof define&&!define.amd?function(e,t){t()}:define)(["jaydata"],function(){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.$data=e()}}(function(){return function e(t,a,r){function n(o,s){if(!a[o]){if(!t[o]){var d="function"==typeof require&&require;if(!s&&d)return d(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=a[o]={exports:{}};t[o][0].call(l.exports,function(e){var a=t[o][1][e];return n(a?a:e)},l,l.exports,e,t,a,r)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(a,"__esModule",{value:!0});var n=e("jaydata/core"),i=r(n),o=e("./oDataConverter.js"),s=(r(o),e("./oDataProvider.js")),d=(r(s),e("./oDataCompiler.js")),u=(r(d),e("./oDataWhereCompiler.js")),l=(r(u),e("./oDataOrderCompiler.js")),p=(r(l),e("./oDataPagingCompiler.js")),f=(r(p),e("./oDataProjectionCompiler.js"));r(f);a["default"]=i["default"],t.exports=a["default"]},{"./oDataCompiler.js":2,"./oDataConverter.js":3,"./oDataOrderCompiler.js":4,"./oDataPagingCompiler.js":5,"./oDataProjectionCompiler.js":6,"./oDataProvider.js":7,"./oDataWhereCompiler.js":8,"jaydata/core":"jaydata/core"}],2:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=r(n);(0,n.$C)("$data.storageProviders.oData.oDataCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={},this.provider={},this.includes=null,this.mainEntitySet=null},compile:function(e){this.provider=e.context.storageProvider,this.context=e.context,e.defaultType&&(this.mainEntitySet=e.context.getEntitySetFromElementType(e.defaultType));var t={urlText:""};this.Visit(e.expression,t),e.modelBinderConfig={};var a=n.Container.createModelBinderConfigCompiler(e,this.includes,!0);a.Visit(e.expression);var r=t.urlText,i=!1;for(var o in t)"urlText"!=o&&"actionPack"!=o&&"data"!=o&&"lambda"!=o&&"method"!=o&&"postData"!=o&&"_isBatchExecuteQuery"!=o&&"_subQueries"!=o&&""!=t[o]&&(r+=i?"&":"?",i=!0,r+="$urlParams"!=o?o+"="+t[o]:t[o]);e.queryText=r,e.postData=t.postData;var s={queryText:r,withInlineCount:"$inlinecount"in t||"$count"in t,method:t.method||"GET",postData:t.postData,isBatchExecuteQuery:t._isBatchExecuteQuery,subQueries:t._subQueries,params:[]};return e._getComplitedData=function(){return s},s},VisitOrderExpression:function(e,t){this.Visit(e.source,t);var a=n.Container.createoDataOrderCompiler(this.provider);a.compile(e,t)},VisitPagingExpression:function(e,t){this.Visit(e.source,t);var a=n.Container.createoDataPagingCompiler(this.provider);a.compile(e,t)},VisitIncludeExpression:function(e,t){if(this.Visit(e.source,t),!t.$select){t.$expand?t.$expand+=",":t.$expand="",t.$expand+=e.selector.value.replace(/\./g,"/"),this.includes=this.includes||[];for(var a=e.selector.value.split("."),r=null,i=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew),o=0;o<a.length;o++){r?r+="."+a[o]:r=a[o];var s=i.Associations[a[o]];s?this.includes.some(function(e){return e.name==r},this)||this.includes.push({name:r,type:s.ToType}):n.Guard.raise(new n.Exception("The given include path is invalid: "+e.selector.value+", invalid point: "+r)),i=this.mainEntitySet.entityContext._storageModel.getStorageModel(s.ToType)}}},VisitFindExpression:function(e,t){if(this.Visit(e.source,t),e.subMember&&(t.urlText+="/"+e.subMember.memberName),t.urlText+="(",1===e.params.length){var a=e.params[0],r=n.Container.resolveName(a.type),i=this.provider.fieldConverter.toDb[r],o=i?i(a.value):a.value;i=this.provider.fieldConverter.escape[r],o=i?i(a.value):a.value,t.urlText+=o}else for(var s=0;s<e.params.length;s++){var a=e.params[s],r=n.Container.resolveName(a.type),i=this.provider.fieldConverter.toDb[r],o=i?i(a.value):a.value;i=this.provider.fieldConverter.escape[r],o=i?i(a.value):a.value,s>0&&(t.urlText+=","),t.urlText+=a.name+"="+o}t.urlText+=")"},VisitProjectionExpression:function(e,t){this.Visit(e.source,t);var a=n.Container.createoDataProjectionCompiler(this.context);a.compile(e,t)},VisitFilterExpression:function(e,t){this.Visit(e.source,t);var a=n.Container.createoDataWhereCompiler(this.provider);t.data="",a.compile(e.selector,t),t.$filter=t.data,t.data=""},VisitInlineCountExpression:function(e,t){this.Visit(e.source,t),"4.0"===this.provider.providerConfiguration.maxDataServiceVersion?t.$count="allpages"===e.selector.value:t.$inlinecount=e.selector.value},VisitEntitySetExpression:function(e,t){if(t.urlText+="/"+e.instance.tableName,e.params)for(var a=0;a<e.params.length;a++)this.Visit(e.params[a],t)},VisitServiceOperationExpression:function(e,t){if(e.boundItem&&(t.urlText+="/"+e.boundItem.entitySet.tableName,e.boundItem.data instanceof i["default"].Entity&&(t.urlText+="("+this.provider.getEntityKeysValue(e.boundItem)+")")),t.urlText+="/"+(e.cfg.namespace?e.cfg.namespace+"."+e.cfg.serviceName:e.cfg.serviceName),t.method=t.method||e.cfg.method,e.params)for(var a=0;a<e.params.length;a++)this.Visit(e.params[a],t)},VisitBatchDeleteExpression:function(e,t){this.Visit(e.source,t),t.urlText+="/$batchDelete",t.method="DELETE"},VisitConstantExpression:function(e,t){var a=n.Container.resolveName(e.type);e.value instanceof i["default"].Entity&&(a=i["default"].Entity.fullName);var r=this.provider.fieldConverter.toDb[a],o=r?r(e.value):e.value;"GET"!==t.method&&t.method?(t.postData=t.postData||{},t.postData[e.name]=o):(r=this.provider.fieldConverter.escape[a],o=r?r(o):o,void 0!==o&&(t.$urlParams?t.$urlParams+="&":t.$urlParams="",t.$urlParams+=e.name+"="+o))},VisitCountExpression:function(e,t){this.Visit(e.source,t),t.urlText+="/$count"},VisitBatchExecuteQueryExpression:function(e,t){t.urlText+="/$batch",t.method="POST",t.postData={__batchRequests:[]},t._isBatchExecuteQuery=!0,t._subQueries=e.members;for(var a=0;a<e.members.length;a++){var r=e.members[a],n=new i["default"].storageProviders.oData.oDataCompiler,o=n.compile(r);t.postData.__batchRequests.push({requestUri:o.queryText,method:o.method,data:o.data,headers:o.headers})}}},{})},{"jaydata/core":"jaydata/core"}],3:[function(e,t,a){(function(t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var r=e("jaydata/core"),n=a(r),i="undefined"!=typeof window?window.atob:"undefined"!=typeof t?t.atob:null,o=a(i);n["default"].defaults=n["default"].defaults||{},n["default"].defaults.oDataWebApi=!1,n["default"].oDataConverter={fromDb:{"$data.Enum":function(e,t){return n["default"].Container.convertTo(e,t)},"$data.Byte":n["default"].Container.proxyConverter,"$data.SByte":n["default"].Container.proxyConverter,"$data.Decimal":function(e){return n["default"].Container.convertTo(e,n["default"].Decimal)},"$data.Float":n["default"].Container.proxyConverter,"$data.Int16":n["default"].Container.proxyConverter,"$data.Int64":function(e){return n["default"].Container.convertTo(e,n["default"].Int64)},"$data.ObjectID":n["default"].Container.proxyConverter,"$data.Integer":n["default"].Container.proxyConverter,"$data.Int32":n["default"].Container.proxyConverter,"$data.Number":n["default"].Container.proxyConverter,"$data.Date":function(e){return e?e instanceof Date?e:"/Date("===e.substring(0,6)?new Date(parseInt(e.substr(6))):(-1!==e.indexOf("Z")||e.match("T.*[+-]")||(e+="Z"),new Date(e)):e},"$data.DateTimeOffset":function(e){return e?e instanceof Date?e:"/Date("===e.substring(0,6)?new Date(parseInt(e.substr(6))):(-1!==e.indexOf("Z")||e.match("T.*[+-]")||(e+="Z"),new Date(e)):e},"$data.Time":function(e){return n["default"].Container.convertTo(e,n["default"].Time)},"$data.Day":n["default"].Container.proxyConverter,"$data.Duration":n["default"].Container.proxyConverter,"$data.String":n["default"].Container.proxyConverter,"$data.Boolean":n["default"].Container.proxyConverter,"$data.Blob":function(e){if("string"!=typeof e)return e;try{return n["default"].Container.convertTo((0,o["default"])(e),"$data.Blob")}catch(t){return e}},"$data.Object":function(e){return void 0===e?new n["default"].Object:"string"==typeof e?JSON.parse(e):e},"$data.Array":function(e){return void 0===e?new n["default"].Array:e instanceof n["default"].Array?e:JSON.parse(e)},"$data.GeographyPoint":function(e){return e?new n["default"].GeographyPoint(e):e},"$data.GeographyLineString":function(e){return e?new n["default"].GeographyLineString(e):e},"$data.GeographyPolygon":function(e){return e?new n["default"].GeographyPolygon(e):e},"$data.GeographyMultiPoint":function(e){return e?new n["default"].GeographyMultiPoint(e):e},"$data.GeographyMultiLineString":function(e){return e?new n["default"].GeographyMultiLineString(e):e},"$data.GeographyMultiPolygon":function(e){return e?new n["default"].GeographyMultiPolygon(e):e},"$data.GeographyCollection":function(e){return e?new n["default"].GeographyCollection(e):e},"$data.GeometryPoint":function(e){return e?new n["default"].GeometryPoint(e):e},"$data.GeometryLineString":function(e){return e?new n["default"].GeometryLineString(e):e},"$data.GeometryPolygon":function(e){return e?new n["default"].GeometryPolygon(e):e},"$data.GeometryMultiPoint":function(e){return e?new n["default"].GeometryMultiPoint(e):e},"$data.GeometryMultiLineString":function(e){return e?new n["default"].GeometryMultiLineString(e):e},"$data.GeometryMultiPolygon":function(e){return e?new n["default"].GeometryMultiPolygon(e):e},"$data.GeometryCollection":function(e){return e?new n["default"].GeometryCollection(e):e},"$data.Guid":function(e){return e?e.toString():e}},toDb:{"$data.Enum":n["default"].Container.proxyConverter,"$data.Entity":n["default"].Container.proxyConverter,"$data.Byte":n["default"].Container.proxyConverter,"$data.SByte":n["default"].Container.proxyConverter,"$data.Decimal":n["default"].Container.proxyConverter,"$data.Float":n["default"].Container.proxyConverter,"$data.Int16":n["default"].Container.proxyConverter,"$data.Int64":n["default"].Container.proxyConverter,"$data.ObjectID":n["default"].Container.proxyConverter,"$data.Integer":n["default"].Container.proxyConverter,"$data.Int32":n["default"].Container.proxyConverter,"$data.Number":n["default"].Container.proxyConverter,"$data.Date":function(e){return e?e.toISOString().replace("Z",""):e},"$data.Time":n["default"].Container.proxyConverter,"$data.Day":n["default"].Container.proxyConverter,"$data.Duration":n["default"].Container.proxyConverter,"$data.DateTimeOffset":function(e){return e?e.toISOString():e},"$data.String":n["default"].Container.proxyConverter,"$data.Boolean":n["default"].Container.proxyConverter,"$data.Blob":function(e){return e?n["default"].Blob.toBase64(e):e},"$data.Object":n["default"].Container.proxyConverter,"$data.Array":n["default"].Container.proxyConverter,"$data.GeographyPoint":n["default"].Container.proxyConverter,"$data.GeographyLineString":n["default"].Container.proxyConverter,"$data.GeographyPolygon":n["default"].Container.proxyConverter,"$data.GeographyMultiPoint":n["default"].Container.proxyConverter,"$data.GeographyMultiLineString":n["default"].Container.proxyConverter,"$data.GeographyMultiPolygon":n["default"].Container.proxyConverter,"$data.GeographyCollection":n["default"].Container.proxyConverter,"$data.GeometryPoint":n["default"].Container.proxyConverter,"$data.GeometryLineString":n["default"].Container.proxyConverter,"$data.GeometryPolygon":n["default"].Container.proxyConverter,"$data.GeometryMultiPoint":n["default"].Container.proxyConverter,"$data.GeometryMultiLineString":n["default"].Container.proxyConverter,"$data.GeometryMultiPolygon":n["default"].Container.proxyConverter,"$data.GeometryCollection":n["default"].Container.proxyConverter,"$data.Guid":n["default"].Container.proxyConverter},escape:{"$data.Enum":function(e,t){return null!==e&&void 0!==e?(t?t.fullName:"")+"'"+e+"'":e},"$data.Entity":function(e){return JSON.stringify(e)},"$data.Integer":n["default"].Container.proxyConverter,"$data.Int32":n["default"].Container.proxyConverter,"$data.Number":function(e){return e&&n["default"].defaults.oDataWebApi?e+"d":e},"$data.Int16":n["default"].Container.proxyConverter,"$data.Byte":n["default"].Container.proxyConverter,"$data.SByte":n["default"].Container.proxyConverter,"$data.Decimal":function(e){return e&&n["default"].defaults.oDataWebApi?e+"m":e},"$data.Float":function(e){return e&&n["default"].defaults.oDataWebApi?e+"f":e},"$data.Int64":n["default"].Container.proxyConverter,"$data.Time":n["default"].Container.proxyConverter,"$data.Day":n["default"].Container.proxyConverter,"$data.Duration":function(e){return e?"duration'"+e+"'":e},"$data.DateTimeOffset":function(e){return e?encodeURIComponent(e):e},"$data.Date":function(e){return e?"datetime'"+e+"'":e},"$data.String":function(e){return"string"==typeof e?"'"+e.replace(/'/g,"''")+"'":e},"$data.ObjectID":function(e){return"string"==typeof e?"'"+e.replace(/'/g,"''")+"'":e},"$data.Boolean":function(e){return"boolean"==typeof e?e.toString():e},"$data.Blob":function(e){return e?"binary'"+e+"'":e},"$data.Object":function(e){return JSON.stringify(e)},"$data.Array":function(e){return JSON.stringify(e)},"$data.GeographyPoint":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyLineString":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyPolygon":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiPoint":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiLineString":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiPolygon":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyCollection":function(e){return e?n["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeometryPoint":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryLineString":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryPolygon":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiPoint":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiLineString":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiPolygon":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryCollection":function(e){return e?n["default"].GeometryBase.stringifyToUrl(e):e},"$data.Guid":function(e){return e?""+e.toString():e}},unescape:{"$data.Entity":function(e,t){var a=t||{},n=JSON.parse(e);if(n&&a.type){var i=r.Container.resolveType(a.type);return new i(n,{converters:void 0})}return n},"$data.Number":function(e){return JSON.parse(e)},"$data.Integer":function(e){return JSON.parse(e)},"$data.Int32":function(e){return JSON.parse(e)},"$data.Byte":function(e){return JSON.parse(e)},"$data.SByte":function(e){return JSON.parse(e)},"$data.Decimal":function(e){return"string"==typeof e&&e.toLowerCase().lastIndexOf("m")===e.length-1?e.substr(0,e.length-1):e},"$data.Float":function(e){return"string"==typeof e&&e.toLowerCase().lastIndexOf("f")===e.length-1?e.substr(0,e.length-1):e},"$data.Int16":function(e){return JSON.parse(e)},"$data.Int64":function(e){return e},"$data.Boolean":function(e){return JSON.parse(e)},"$data.Date":function(e){return"string"==typeof e&&/^datetime'/.test(e)?e.slice(9,e.length-1):e},"$data.String":function(e){return"string"==typeof e&&0===e.indexOf("'")&&e.lastIndexOf("'")===e.length-1?e.slice(1,e.length-1):e},"$data.ObjectID":function(e){return"string"==typeof e&&0===e.indexOf("'")&&e.lastIndexOf("'")===e.length-1?e.slice(1,e.length-1):e},"$data.Guid":function(e){if(/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/.test(e)){var t=e.slice(5,e.length-1);return n["default"].parseGuid(t).toString()}return e},"$data.Array":function(e,t){var a=t||{},i=JSON.parse(e)||[];if(i&&a.elementType){var o=r.Container.resolveType(a.elementType),s=r.Container.resolveName(o);if(o&&o.isAssignableTo&&o.isAssignableTo(n["default"].Entity)&&(s=n["default"].Entity.fullName),Array.isArray(i))for(var d=n["default"].oDataConverter.unescape[s],u=0;u<i.length;u++)i[u]=d?d(i[u]):i[u];return i}return i},"$data.DateTimeOffset":function(e){return"string"==typeof e?n["default"].Container.convertTo(e,n["default"].DateTimeOffset):e},"$data.Time":function(e){return"string"==typeof e&&/^time'/.test(e)?n["default"].Container.convertTo(e.slice(5,e.length-1),n["default"].Time):e},"$data.Day":function(e){return"string"==typeof e&&/^date'/.test(e)?n["default"].Container.convertTo(e.slice(5,e.length-1),n["default"].Day):e},"$data.Duration":function(e){return"string"==typeof e&&/^duration'/.test(e)?n["default"].Container.convertTo(e.slice(9,e.length-1),n["default"].Duration):e},"$data.Blob":function(e){if("string"==typeof e){if(/^X'/.test(e))return n["default"].Blob.createFromHexString(e.slice(2,e.length-1));if(/^binary'/.test(e))return n["default"].Blob.createFromHexString(e.slice(7,e.length-1))}return e},"$data.Object":function(e){return JSON.parse(e)},"$data.GeographyPoint":function(e){if(/^geography'POINT\(/i.test(e)){var t=e.slice(10,e.length-1);return n["default"].GeographyBase.parseFromString(t)}return e},"$data.GeographyPolygon":function(e){if(/^geography'POLYGON\(/i.test(e)){var t=e.slice(10,e.length-1);return n["default"].GeographyBase.parseFromString(t)}return e},"$data.GeometryPoint":function(e){if(/^geometry'POINT\(/i.test(e)){var t=e.slice(9,e.length-1);return n["default"].GeometryBase.parseFromString(t)}return e},"$data.GeometryPolygon":function(e){if(/^geometry'POLYGON\(/i.test(e)){var t=e.slice(9,e.length-1);return n["default"].GeometryBase.parseFromString(t)}return e}},xmlEscape:{"$data.Byte":function(e){return e.toString()},"$data.SByte":function(e){return e.toString()},"$data.Decimal":function(e){return e.toString()},"$data.Float":function(e){return e.toString()},"$data.Int16":function(e){return e.toString()},"$data.Int64":function(e){return e.toString()},"$data.Integer":function(e){return e.toString()},"$data.Int32":function(e){return e.toString()},"$data.Boolean":function(e){return e.toString()},"$data.Blob":function(e){return n["default"].Blob.toBase64(e)},"$data.Date":function(e){return e.toISOString().replace("Z","")},"$data.DateTimeOffset":function(e){return e.toISOString()},"$data.Time":function(e){return e.toString()},"$data.Day":function(e){return e.toString()},"$data.Duration":function(e){return e.toString()},"$data.Number":function(e){return e.toString()},"$data.String":function(e){return e.toString()},"$data.ObjectID":function(e){return e.toString()},"$data.Object":function(e){return JSON.stringify(e)},"$data.Guid":function(e){return e.toString()}},simple:{"$data.Byte":function(e){return e.toString()},"$data.SByte":function(e){return e.toString()},"$data.Decimal":function(e){return e.toString()},"$data.Float":function(e){return e.toString()},"$data.Int16":function(e){return e.toString()},"$data.Int64":function(e){return e.toString()},"$data.ObjectID":function(e){return e.toString()},"$data.Integer":function(e){return e.toString()},"$data.Int32":function(e){return e.toString()},"$data.Number":function(e){return e.toString()},"$data.Date":function(e){return e instanceof n["default"].Date?e.toISOString().replace("Z",""):e.toString()},"$data.DateTimeOffset":function(e){return e?e.toISOString():e},"$data.Time":function(e){return e.toString()},"$data.Day":function(e){return e.toString()},"$data.Duration":function(e){return e.toString()},"$data.String":function(e){return e.toString()},"$data.Boolean":function(e){return e.toString()},"$data.Blob":function(e){return e},"$data.Object":function(e){return JSON.stringify(e)},"$data.Array":function(e){return JSON.stringify(e)},"$data.Guid":function(e){return e.toString()},"$data.GeographyPoint":function(e){return JSON.stringify(e)},"$data.GeometryPoint":function(e){return JSON.stringify(e)},"$data.GeographyLineString":function(e){return JSON.stringify(e)},"$data.GeographyPolygon":function(e){return JSON.stringify(e)},"$data.GeographyMultiPoint":function(e){return JSON.stringify(e)},"$data.GeographyMultiLineString":function(e){return JSON.stringify(e)},"$data.GeographyMultiPolygon":function(e){return JSON.stringify(e)},"$data.GeographyCollection":function(e){return JSON.stringify(e)},"$data.GeometryLineString":function(e){return JSON.stringify(e)},"$data.GeometryPolygon":function(e){return JSON.stringify(e)},"$data.GeometryMultiPoint":function(e){return JSON.stringify(e)},"$data.GeometryMultiLineString":function(e){return JSON.stringify(e)},"$data.GeometryMultiPolygon":function(e){return JSON.stringify(e)},"$data.GeometryCollection":function(e){return JSON.stringify(e)}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"jaydata/core":"jaydata/core"}],4:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=r(n);(0,n.$C)("$data.storageProviders.oData.oDataOrderCompiler",i["default"].storageProviders.oData.oDataWhereCompiler,null,{constructor:function(e){this.provider=e},compile:function(e,t){this.Visit(e,t)},VisitOrderExpression:function(e,t){var a={data:""};this.Visit(e.selector,a),t.$orderby?t.$orderby+=",":t.$orderby="",t.$orderby+=a.data+(e.nodeType==i["default"].Expressions.ExpressionType.OrderByDescending?" desc":"")},VisitParametricQueryExpression:function(e,t){this.Visit(e.expression,t)},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitComplexTypeExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t),t.data+="/"},VisitEntitySetExpression:function(e,t){e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&(this.Visit(e.source,t),this.Visit(e.selector,t))},VisitAssociationInfoExpression:function(e,t){t.data+=e.associationInfo.FromPropertyName+"/"},VisitEntityExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitMemberInfoExpression:function(e,t){t.data+=e.memberName},VisitEntityFieldOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var a=e.operation.memberDefinition,r=a.mapTo||a.name;t.data+=r,t.data+="(";var o=0,s=a.parameters||[{name:"@expression"}],d=s.map(function(t,a){return"@expression"===t.name?e.source:e.parameters[o++]});d.forEach(function(e,a){a>0&&(t.data+=","),this.Visit(e,t)},this),t.data+=")"},VisitEntityFunctionOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression),this.Visit(e.source,t);var a=e.operation.memberDefinition,r=a.mapTo||a.name;t.data+=r,t.data+="(";var o=0,s=a.method.params||[{name:"@expression"}],d=s.map(function(t,a){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;d.forEach(function(e,a){void 0===e||e instanceof i["default"].Expressions.ConstantExpression&&"undefined"==typeof e.value||(u>0&&(t.data+=","),u++,t.data+=s[a].name+"=",this.Visit(e,t))},this),t.data+=")"},VisitContextFunctionOperationExpression:function(e,t){return this.VisitEntityFunctionOperationExpression(e,t)}})},{"jaydata/core":"jaydata/core"}],5:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=r(n);(0,n.$C)("$data.storageProviders.oData.oDataPagingCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.provider=e},compile:function(e,t){this.Visit(e,t)},VisitPagingExpression:function(e,t){var a={data:""};switch(this.Visit(e.amount,a),e.nodeType){case i["default"].Expressions.ExpressionType.Skip:t.$skip=a.data;break;case i["default"].Expressions.ExpressionType.Take:t.$top=a.data;break;default:n.Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(e,t){var a=n.Container.resolveName(e.type),r=this.provider.fieldConverter.escape[a];t.data+=r?r(e.value):e.value}})},{"jaydata/core":"jaydata/core"}],6:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=r(n);(0,n.$C)("$data.storageProviders.oData.oDataProjectionCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.entityContext=e,this.hasObjectLiteral=!1,this.ObjectLiteralPath="",this.modelBinderMapping=[]},compile:function(e,t){this.Visit(e,t)},VisitProjectionExpression:function(e,t){t.data="",this.mapping="",this.Visit(e.selector,t),t.$select?t.$select+=",":t.$select="",t.$select+=t.data,t.data=""},VisitParametricQueryExpression:function(e,t){if(this.Visit(e.expression,t),(e.expression instanceof i["default"].Expressions.EntityExpression||e.expression instanceof i["default"].Expressions.EntitySetExpression)&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/")),e.expression instanceof i["default"].Expressions.ComplexTypeExpression){var a=this.mapping.split(".");a.pop(),a.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=a.join("/"))}else{var a=this.mapping.split(".");a.pop(),a.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=a.join("/"))}},VisitObjectLiteralExpression:function(e,t){var a=this.ObjectLiteralPath;this.hasObjectLiteral=!0,e.members.forEach(function(a,r){this.Visit(a,t),r<e.members.length-1&&(t.data+=","),this.mapping=""},this),this.ObjectLiteralPath=a},VisitObjectFieldExpression:function(e,t){if(this.ObjectLiteralPath?this.ObjectLiteralPath+="."+e.fieldName:this.ObjectLiteralPath=e.fieldName,this.Visit(e.expression,t),e.expression instanceof i["default"].Expressions.EntityExpression||e.expression instanceof i["default"].Expressions.EntitySetExpression)t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/");else{var a=this.mapping.split(".");a.pop(),a.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=a.join("/"))}},VisitComplexTypeExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitEntityExpression:function(e,t){this.Visit(e.source,t)},VisitEntitySetExpression:function(e,t){e.source instanceof i["default"].Expressions.EntityExpression&&this.Visit(e.source,t),e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&this.Visit(e.selector,t)},VisitAssociationInfoExpression:function(e,t){t.data&&t.data.length>0&&","!=t.data[t.data.length-1]&&(t.data+="/"),t.data+=e.associationInfo.FromPropertyName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=e.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(e,t){t.data&&t.data.length>0&&","!=t.data[t.data.length-1]&&(t.data+="/"),t.data+=e.memberName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=e.memberName},VisitConstantExpression:function(e,t){t.data=t.data.slice(0,t.data.length-1)}})},{"jaydata/core":"jaydata/core"}],7:[function(e,t,a){(function(t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=e("jaydata/core"),o=a(i),s="undefined"!=typeof window?window.odatajs:"undefined"!=typeof t?t.odatajs:null,d=a(s),u=o["default"].__global.OData,l=o["default"].__global.datajs;r=function(e){if(e&&e.jsonHandler&&"useJsonLight"in e.jsonHandler&&"object"===("undefined"==typeof l?"undefined":n(l))&&!l.version){o["default"].Trace.log("!!!!!!! - patch datajs 1.1.0");var t=e.defaultHandler.read;e.defaultHandler.read=function(e,a){delete a.contentType,delete a.dataServiceVersion,t.apply(this,arguments)};var a=e.defaultHandler.write;e.defaultHandler.write=function(e,t){delete t.contentType,delete t.dataServiceVersion,a.apply(this,arguments)}}r=function(){}},(0,i.$C)("$data.storageProviders.oData.oDataProvider",o["default"].StorageProviderBase,null,{constructor:function(e,t){this.SqlCommands=[],this.context=t,this.providerConfiguration=o["default"].typeSystem.extend({dbCreation:o["default"].storageProviders.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"4.0",dataServiceVersion:void 0,user:null,password:null,withCredentials:!1,UpdateMethod:"PATCH"},e),"4.0"===this.providerConfiguration.maxDataServiceVersion?"undefined"==typeof d["default"]||"undefined"==typeof d["default"].oData?i.Guard.raise(new i.Exception("odatajs is required","Not Found!")):this.oData=d["default"].oData:"undefined"==typeof u?i.Guard.raise(new i.Exception("datajs is required","Not Found!")):(this.oData=u,r(this.oData)),this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction),this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},fixkDataServiceVersions:function(e){this.providerConfiguration.dataServiceVersion>this.providerConfiguration.maxDataServiceVersion&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.setDataServiceVersionToMax===!0&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion),(e&&!e.UpdateMethod&&this.providerConfiguration.dataServiceVersion<"3.0"||!this.providerConfiguration.dataServiceVersion)&&(this.providerConfiguration.UpdateMethod="MERGE")},initializeStore:function(e){switch(e=o["default"].typeSystem.createCallbackSetting(e),this.providerConfiguration.dbCreation){case o["default"].storageProviders.DbCreationType.DropAllExistingTables:var t=this;if(this.providerConfiguration.serviceUrl){var a=[{requestUri:t.providerConfiguration.serviceUrl+"/Delete",method:"POST"},function(a){e.success(t.context)},function(a){e.success(t.context)}];this.appendBasicAuth(a[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,a),this.oData.request.apply(this,a)}else e.success(t.context);break;default:e.success(this.context)}},buildDbType_generateConvertToFunction:function(e,t){return function(a,r){var n=new e.PhysicalType;return n.entityState=a.entityState,e.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(e){n.initData[e.name]=a[e.name]},this),e.Associations&&e.Associations.forEach(function(e){if("*"==e.FromMultiplicity&&"0..1"==e.ToMultiplicity||"0..1"==e.FromMultiplicity&&"1"==e.ToMultiplicity||"$$unbound"==e.FromMultiplicity){var s=a[e.FromPropertyName];if(void 0!==s)if(s instanceof o["default"].Array)n.initData[e.FromPropertyName]=n[e.FromPropertyName]||[],s.forEach(function(a){if(a.entityState==o["default"].EntityState.Modified||r.indexOf(a)<0){var s=t._storageModel.getStorageModel(a.getType()),d=s.TableName,u="("+t.storageProvider.getEntityKeysValue({data:a,entitySet:t.getEntitySetFromElementType(a.getType())})+")";n.initData[e.FromPropertyName].push({__metadata:{uri:d+u}})}else{var l=r.indexOf(a);0>l&&i.Guard.raise("Dependency graph error"),n.initData[e.FromPropertyName].push({__metadata:{uri:"$"+(l+1)}})}},this);else if(null===s)n.initData[e.FromPropertyName]=null;else if(s.entityState==o["default"].EntityState.Modified||r.indexOf(s)<0){var d=t._storageModel.getStorageModel(s.getType()),u=d.TableName,l="("+t.storageProvider.getEntityKeysValue({data:s,entitySet:t.getEntitySetFromElementType(s.getType())})+")";n.initData[e.FromPropertyName]={__metadata:{uri:u+l
}}}else{var p=r.indexOf(s);0>p&&i.Guard.raise("Dependency graph error"),n.initData[e.FromPropertyName]={__metadata:{uri:"$"+(p+1)}}}}},this),e.ComplexTypes&&e.ComplexTypes.forEach(function(e){n.initData[e.FromPropertyName]=a[e.FromPropertyName]},this),n}},buildDbType_modifyInstanceDefinition:function(){},executeQuery:function(e,t){t=o["default"].typeSystem.createCallbackSetting(t);var a={};try{a=this._compile(e)}catch(r){return void t.error(r)}var s=(this.context,this),d="@odata.count",u=[{requestUri:this.providerConfiguration.oDataServiceHost+a.queryText,method:a.method,data:a.postData,headers:{}},function(r,u,l){if(r||!u.body||a.isBatchExecuteQuery||(r=JSON.parse(u.body)),t.success){var p=function(e,t,a){e.rawDataList="string"==typeof t?[{cnt:i.Container.convertTo(t,o["default"].Integer)}]:t,a.withInlineCount&&"object"===("undefined"==typeof t?"undefined":n(t))&&("undefined"!=typeof t[d]||"d"in t&&"undefined"!=typeof t.d[d])&&(e.__count=new Number("undefined"!=typeof t[d]?t[d]:t.d[d]).valueOf())};if(a.isBatchExecuteQuery){e.rawDataList=a.subQueries;for(var f=0;f<r.__batchResponses.length;f++){var c=r.__batchResponses[f];if(!c.data){if(!c.body)return void t.error(s.parseError(c,arguments));c.data=JSON.parse(c.body)}p(a.subQueries[f],c.data,a.subQueries[f]._getComplitedData())}}else p(e,r,a);t.success(e)}},function(e){t.error(s.parseError(e,arguments))},a.isBatchExecuteQuery?this.oData.batchHandler:void 0];"undefined"!=typeof this.providerConfiguration.enableJSONP&&(u[0].enableJsonpCallback=this.providerConfiguration.enableJSONP),"undefined"!=typeof this.providerConfiguration.useJsonLight&&(u[0].useJsonLight=this.providerConfiguration.useJsonLight),this.appendBasicAuth(u[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,u),this.oData.request.apply(this,u)},_compile:function(e,t){var a=new o["default"].storageProviders.oData.oDataCompiler,r=a.compile(e);return r},saveChanges:function(e,t){if(t.length>0){var a=this.buildIndependentBlocks(t);this.saveInternal(a,0,e)}else e.success(0)},saveInternal:function(e,t,a){(this.providerConfiguration.disableBatch===!0||"object"===n(o["default"].defaults)&&o["default"].defaults.disableBatch===!0)&&"function"==typeof this._saveRestMany?this._saveRestMany(e,t,a):e.length>1||1==e.length&&e[0].length>1?this._saveBatch(e,t,a):this._saveRest(e,t,a)},_saveRest:function(e,t,a){for(var r,n=[],s=0;s<e.length;s++)for(var d=0;d<e[s].length;d++)switch(n.push(e[s][d].data),r={requestUri:this.providerConfiguration.oDataServiceHost+"/",headers:{}},"undefined"!=typeof this.providerConfiguration.useJsonLight&&(r.useJsonLight=this.providerConfiguration.useJsonLight),e[s][d].data.entityState){case o["default"].EntityState.Unchanged:continue;case o["default"].EntityState.Added:r.method="POST",r.requestUri+=e[s][d].entitySet.tableName,r.data=this.save_getInitData(e[s][d],n);break;case o["default"].EntityState.Modified:r.method=this.providerConfiguration.UpdateMethod,r.requestUri+=e[s][d].entitySet.tableName,r.requestUri+="("+this.getEntityKeysValue(e[s][d])+")",this.save_addConcurrencyHeader(e[s][d],r.headers),r.data=this.save_getInitData(e[s][d],n);break;case o["default"].EntityState.Deleted:r.method="DELETE",r.requestUri+=e[s][d].entitySet.tableName,r.requestUri+="("+this.getEntityKeysValue(e[s][d])+")",this.save_addConcurrencyHeader(e[s][d],r.headers);break;default:i.Guard.raise(new i.Exception("Not supported Entity state"))}var u=this,l=[r,function(e,t){if(t.statusCode>=200&&t.statusCode<300){var r=n[0];if(204==t.statusCode){if(t.headers.ETag||t.headers.Etag||t.headers.etag){var i=r.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===o["default"].ConcurrencyMode.Fixed});i&&i[0]&&(r[i[0].name]=t.headers.ETag||t.headers.Etag||t.headers.etag)}}else u.reload_fromResponse(r,e,t);a.success&&a.success(n.length)}else a.error(u.parseError(t))},function(e){a.error(u.parseError(e))}];this.appendBasicAuth(l[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,l),this.oData.request.apply(this,l)},_saveBatch:function(e,t,a){for(var r=[],n=[],s=0;s<e.length;s++)for(var d=0;d<e[s].length;d++){n.push(e[s][d].data);var u={};switch(u.headers={"Content-Id":n.length},e[s][d].data.entityState){case o["default"].EntityState.Unchanged:continue;case o["default"].EntityState.Added:u.method="POST",u.requestUri=e[s][d].entitySet.tableName,u.data=this.save_getInitData(e[s][d],n);break;case o["default"].EntityState.Modified:u.method=this.providerConfiguration.UpdateMethod,u.requestUri=e[s][d].entitySet.tableName,u.requestUri+="("+this.getEntityKeysValue(e[s][d])+")",this.save_addConcurrencyHeader(e[s][d],u.headers),u.data=this.save_getInitData(e[s][d],n);break;case o["default"].EntityState.Deleted:u.method="DELETE",u.requestUri=e[s][d].entitySet.tableName,u.requestUri+="("+this.getEntityKeysValue(e[s][d])+")",this.save_addConcurrencyHeader(e[s][d],u.headers);break;default:i.Guard.raise(new i.Exception("Not supported Entity state"))}r.push(u)}var l=this,p=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:r}]},headers:{}},function(e,t){if(202==t.statusCode){for(var r=e.__batchResponses[0].__changeResponses,s=[],d=0;d<r.length;d++)if(r[d].statusCode>=200&&r[d].statusCode<300){var u=n[d];if(204==r[d].statusCode){if(r[d].headers.ETag||r[d].headers.Etag||r[d].headers.etag){var p=u.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===o["default"].ConcurrencyMode.Fixed});p&&p[0]&&(u[p[0].name]=r[d].headers.ETag||r[d].headers.Etag||r[d].headers.etag)}continue}l.reload_fromResponse(u,r[d].data,r[d])}else s.push(l.parseError(r[d]));s.length>0?1===s.length?a.error(s[0]):a.error(new i.Exception("See inner exceptions","Batch failed",s)):a.success&&a.success(n.length)}else a.error(l.parseError(t))},function(e){a.error(l.parseError(e))},this.oData.batchHandler];"undefined"!=typeof this.providerConfiguration.useJsonLight&&(p[0].useJsonLight=this.providerConfiguration.useJsonLight),this.appendBasicAuth(p[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,p),this.oData.request.apply(this,p)},reload_fromResponse:function(e,t,a){var r=this;e.getType().memberDefinitions.getPublicMappedProperties().forEach(function(n){var s=i.Container.resolveType(n.type);if(n.computed||n.key||!n.inverseProperty)if(n.concurrencyMode===o["default"].ConcurrencyMode.Fixed)e[n.name]=a.headers.ETag||a.headers.Etag||a.headers.etag;else if(n.isAssignableTo)t[n.name]?e[n.name]=new s(t[n.name],{converters:r.fieldConverter.fromDb}):e[n.name]=t[n.name];else if(s===o["default"].Array&&n.elementType){var d=i.Container.resolveType(n.elementType);if(t[n.name]&&Array.isArray(t[n.name])){for(var u=[],l=0;l<t[n.name].length;l++){var p=t[n.name][l];if(d.isAssignableTo&&!Object.isNullOrUndefined(p))u.push(new d(p,{converters:r.fieldConverter.fromDb}));else{var f=i.Container.resolveName(d),c=r.fieldConverter.fromDb[f];u.push(c?c(p):p)}}e[n.name]=u}else t[n.name]||(e[n.name]=t[n.name])}else{var y=i.Container.resolveName(n.type),m=r.fieldConverter.fromDb[y];e[n.name]=m?m(t[n.name]):t[n.name]}},this)},save_getInitData:function(e,t,a,r){var n=this;a?e.physicalData=e.data:e.physicalData=this.context._storageModel.getStorageModel(e.data.getType()).PhysicalType.convertTo(e.data,t);var s={};return e.physicalData.getType().memberDefinitions.asArray().forEach(function(a){if(a.kind==o["default"].MemberTypes.complexProperty&&e.physicalData[a.name])s[a.name]=n.save_getInitData({data:e.physicalData[a.name]},t,!0,!0);else if((a.kind==o["default"].MemberTypes.navProperty||a.kind==o["default"].MemberTypes.property&&!a.notMapped)&&(r||"undefined"==typeof a.concurrencyMode&&(a.key===!0||e.data.entityState===o["default"].EntityState.Added||e.data.changedProperties&&e.data.changedProperties.some(function(e){return e.name===a.name}))))if(a.kind==o["default"].MemberTypes.navProperty&&e.physicalData[a.name]&&"4.0"===this.providerConfiguration.maxDataServiceVersion)s[a.name+"@odata.bind"]=e.physicalData[a.name].__metadata.uri;else{var d=i.Container.resolveName(a.type),u=n.fieldConverter.toDb[d];s[a.name]=u?u(e.physicalData[a.name]):e.physicalData[a.name]}},this),s},save_addConcurrencyHeader:function(e,t){var a=e.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===o["default"].ConcurrencyMode.Fixed});a&&a[0]&&(t["If-Match"]=e.data[a[0].name])},getTraceString:function(e){this._compile(e);return e},supportedDataTypes:{value:[o["default"].Array,o["default"].Integer,o["default"].String,o["default"].Number,o["default"].Blob,o["default"].Boolean,o["default"].Date,o["default"].Object,o["default"].GeographyPoint,o["default"].Guid,o["default"].GeographyLineString,o["default"].GeographyPolygon,o["default"].GeographyMultiPoint,o["default"].GeographyMultiLineString,o["default"].GeographyMultiPolygon,o["default"].GeographyCollection,o["default"].GeometryPoint,o["default"].GeometryLineString,o["default"].GeometryPolygon,o["default"].GeometryMultiPoint,o["default"].GeometryMultiLineString,o["default"].GeometryMultiPolygon,o["default"].GeometryCollection,o["default"].Byte,o["default"].SByte,o["default"].Decimal,o["default"].Float,o["default"].Int16,o["default"].Int32,o["default"].Int64,o["default"].Time,o["default"].Day,o["default"].DateTimeOffset,o["default"].Duration],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},divide:{mapTo:"div",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},multiply:{mapTo:"mul",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:[{allowedType:"string",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},{allowedType:"GeographyLineString",mapTo:"geo.length",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:["GeographyLineString"]}],fixedDataType:"decimal"},{allowedType:"GeometryLineString",mapTo:"geo.length",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryLineString"}],fixedDataType:"decimal"}],strLength:{mapTo:"length",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},month:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},distance:[{allowedType:"GeographyPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"to",dataType:"GeographyPoint"}],fixedDataType:"decimal"},{allowedType:"GeometryPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"to",dataType:"GeometryPoint"}],fixedDataType:"decimal"}],intersects:[{allowedType:"GeographyPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"in",dataType:"GeographyPolygon"}]},{allowedType:"GeometryPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[o["default"].Expressions.FilterExpression,o["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"in",dataType:"GeometryPolygon"}]}]},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[o["default"].Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:o["default"].Expressions.SomeExpression},every:{invokable:!1,allowedIn:[o["default"].Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"all",frameType:o["default"].Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{},batchDelete:{},withInlineCount:{},find:{}},enumerable:!0,writable:!0},supportedContextOperation:{value:{batchExecuteQuery:!0},enumerable:!0,writable:!0},fieldConverter:{value:o["default"].oDataConverter},resolveTypeOperations:function(e,t,a){var r=t.entityType.getMemberDefinition(e);return r&&r.method&&r.method.IsSideEffecting===!1&&r.method.returnType&&(a===o["default"].Expressions.FilterExpression||a===o["default"].Expressions.OrderExpression)||i.Guard.raise(new i.Exception("Entity '"+t.entityType.name+"' Operation '"+e+"' is not supported by the provider")),r},resolveSetOperations:function(e,t,a){if(t){var r=t.storageModel.ContextType.getMemberDefinition(t.storageModel.ItemName);if(r&&r.actions&&r.actions[e]){var n=o["default"].MemberDefinition.translateDefinition(r.actions[e],e,this.getType());return n&&n.method&&n.method.IsSideEffecting===!1&&n.method.returnType&&(a===o["default"].Expressions.FilterExpression||a===o["default"].Expressions.OrderExpression)||i.Guard.raise(new i.Exception("Collection '"+t.storageModel.ItemName+"' Operation '"+e+"' is not supported by the provider")),n}}return o["default"].StorageProviderBase.prototype.resolveSetOperations.apply(this,arguments)},resolveContextOperations:function(e,t,a){var r=this.context.getType().getMemberDefinition(e);return r&&r.method&&r.method.IsSideEffecting===!1&&r.method.returnType&&(a===o["default"].Expressions.FilterExpression||a===o["default"].Expressions.OrderExpression)||i.Guard.raise(new i.Exception("Context '"+t.instance.getType().name+"' Operation '"+e+"' is not supported by the provider")),r},getEntityKeysValue:function(e){for(var t=[],a=void 0,r=e.data.getType().memberDefinitions.getKeyProperties(),n=0,o=r.length;o>n;n++){var s=r[n];if(s.key){a=e.data[s.name];var d=i.Container.resolveName(s.type),u=this.fieldConverter.toDb[d];a=u?u(a):a,u=this.fieldConverter.escape[d],a=u?u(a):a,t.push(s.name+"="+a)}}return t.length>1?t.join(","):a},getFieldUrl:function(e,t,a){var r=this.getEntityKeysValue({data:e}),n=this.providerConfiguration.oDataServiceHost;return n.lastIndexOf("/")===n.length&&(n=n.substring(0,n.length-1)),n+"/"+a.tableName+"("+r+")/"+t+"/$value"},parseError:function(e,t){var a=(e.response||e||{}).body||"";try{if(0===a.indexOf("{")){var r=JSON.parse(a);r=r["odata.error"]||r.error||r,r.message&&(a=r.message.value||r.message)}}catch(n){}return new i.Exception(a,e.message,t||e)},appendBasicAuth:function(e,t,a,r){e.headers=e.headers||{},!e.headers.Authorization&&t&&a&&(e.headers.Authorization="Basic "+this.__encodeBase64(t+":"+a)),r&&(e.withCredentials=r)},__encodeBase64:function(e){var t,a,r,n,i,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=e,d="",u="",l="",p=0;do t=s.charCodeAt(p++),a=s.charCodeAt(p++),u=s.charCodeAt(p++),r=t>>2,n=(3&t)<<4|a>>4,i=(15&a)<<2|u>>6,l=63&u,isNaN(a)?i=l=64:isNaN(u)&&(l=64),d=d+o.charAt(r)+o.charAt(n)+o.charAt(i)+o.charAt(l),t=a=u="",r=n=i=l="";while(p<s.length);return d}},null),o["default"].StorageProviderBase.registerProvider("oData",o["default"].storageProviders.oData.oDataProvider)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"jaydata/core":"jaydata/core"}],8:[function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=r(n);(0,n.$C)("$data.storageProviders.oData.oDataWhereCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e,t){this.provider=e,this.lambdaPrefix=t},compile:function(e,t){this.Visit(e,t)},VisitParametricQueryExpression:function(e,t){this.Visit(e.expression,t)},VisitUnaryExpression:function(e,t){t.data+=e.resolution.mapTo,t.data+="(",this.Visit(e.operand,t),t.data+=")"},VisitSimpleBinaryExpression:function(e,t){if(t.data+="(","in"==e.nodeType){n.Guard.requireType("expression.right",e.type,i["default"].Expressions.ConstantExpression);var a=e.right.value;a instanceof Array||n.Guard.raise(new n.Exception("Right to the 'in' operator must be an array value"));var r=null,o={mapTo:"or",dataType:"boolean",name:"or"},s={mapTo:"eq",dataType:"boolean",name:"equal"};a.forEach(function(t){var a=t,d=n.Container.createSimpleBinaryExpression(e.left,a,i["default"].Expressions.ExpressionType.Equal,"==","boolean",s);r=r?n.Container.createSimpleBinaryExpression(r,d,i["default"].Expressions.ExpressionType.Or,"||","boolean",o):d});var d=t.data;t.data="",this.Visit(r,t),t.data=d+t.data.replace(/\(/g,"").replace(/\)/g,"")}else this.Visit(e.left,t),t.data+=" ",t.data+=e.resolution.mapTo,t.data+=" ",this.Visit(e.right,t);t.data+=")"},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),e.source instanceof i["default"].Expressions.ComplexTypeExpression&&(t.data+="/"),this.Visit(e.selector,t)},VisitAssociationInfoExpression:function(e,t){t.data+=e.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(e,t){t.data+=e.memberName},VisitQueryParameterExpression:function(e,t){var a=n.Container.resolveName(e.type),r=this.provider.fieldConverter.toDb[a],i=r?r(e.value):e.value;r=this.provider.fieldConverter.escape[a],t.data+=r?r(i):i},VisitEntityFieldOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var a=e.operation.memberDefinition,r=a.mapTo||a.name;t.data+=r,t.data+="(";var o=0,s=a.parameters||[{name:"@expression"}],d=s.map(function(t,a){return"@expression"===t.name?e.source:e.parameters[o++]});d.forEach(function(e,a){a>0&&(t.data+=","),this.Visit(e,t)},this),t.data+=")"},VisitEntityFunctionOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression),this.Visit(e.source,t);var a=e.operation.memberDefinition,r=a.mapTo||a.name;t.data+=r,t.data+="(";var o=0,s=a.method.params||[{name:"@expression"}],d=s.map(function(t,a){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;d.forEach(function(e,a){void 0===e||e instanceof i["default"].Expressions.ConstantExpression&&"undefined"==typeof e.value||(u>0&&(t.data+=","),u++,t.data+=s[a].name+"=",this.Visit(e,t))},this),t.data+=")"},VisitContextFunctionOperationExpression:function(e,t){return this.VisitEntityFunctionOperationExpression(e,t)},VisitConstantExpression:function(e,t){var a=n.Container.resolveName(e.type),r=this.provider.fieldConverter.toDb[a],i=r?r(e.value):e.value;r=this.provider.fieldConverter.escape[a],t.data+=r?r(i):i},VisitEntityExpression:function(e,t){this.Visit(e.source,t),this.lambdaPrefix&&e.selector.lambda&&(t.lambda=e.selector.lambda,t.data+=e.selector.lambda+"/")},VisitEntitySetExpression:function(e,t){this.Visit(e.source,t),e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&(this.Visit(e.selector,t),t.data+="/")},VisitFrameOperationExpression:function(e,t){this.Visit(e.source,t),n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var a=e.operation.memberDefinition,r=a.mapTo||a.name;t.data+=r,t.data+="(";for(var o=0,s=a.parameters||[{name:"@expression"}],d=s.map(function(t,a){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;u<d.length;u++){var l=d[u];if(l&&l.value instanceof i["default"].Queryable){var p=new a.frameType(l.value.expression),f=n.Container.createQueryExpressionCreator(l.value.entityContext),c=f.Visit(p),y=new i["default"].storageProviders.oData.oDataWhereCompiler(this.provider,!0),m={data:""};y.compile(c,m);t.data+=m.lambda+": "+m.data}}t.data+=")"}})},{"jaydata/core":"jaydata/core"}]},{},[1])(1)})})}();
//# sourceMappingURL=oDataProvider.min.js.map
